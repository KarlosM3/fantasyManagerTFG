<div class="team-points-container">
  <div class="header">
    <h2>Puntos del Equipo</h2>
    <div class="matchday-selector">
      <label for="matchday">Jornada:</label>
      <select id="matchday" [(ngModel)]="matchday" (change)="changeMatchday(matchday)">
        <option *ngFor="let md of availableMatchdays" [value]="md">{{ md }}</option>
      </select>
    </div>
    <div class="total-points">
      <h3>Puntos en la jornada {{ matchday }}</h3>
      <p>{{ getMatchdayPoints(matchday) }}</p>
    </div>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    <p>{{ errorMessage }}</p>
    <button (click)="clearMessages()">×</button>
  </div>

  <div *ngIf="successMessage" class="success-message">
    <p>{{ successMessage }}</p>
    <button (click)="clearMessages()">×</button>
  </div>

  <div class="formation-view" style="height: 700px;" *ngIf="!loading">
    <div class="formation-label">Formación: {{ getFormationString() }}</div>

    <!-- Campo de fútbol con jugadores -->
    <div class="pitch">
      <!-- Portero -->
      <div class="position-row goalkeepers">
        <div class="player-card" *ngFor="let player of goalkeepers">
          <div class="team-badge" *ngIf="player.team">
            <img [src]="player.team.badge || player.team.badgeColor || 'assets/img/team-placeholder.png'" alt="Escudo">
          </div>
          <div class="player-image-container">
            <img [src]="player?.images?.transparent?.['256x256'] || 'assets/img/player-placeholder.png'" alt="{{ player.nickname }}">
            <span class="player-position-badge">POR</span>
          </div>
          <div class="player-info-container">
            <div class="player-name">{{ player.nickname }}</div>
            <div class="player-points">{{ player.matchdayPoints || 0 }} pts</div>
          </div>
        </div>
      </div>

      <!-- Defensas -->
      <div class="position-row defenders">
        <div class="player-card" *ngFor="let player of defenders">
          <div class="team-badge" *ngIf="player.team">
            <img [src]="player.team.badge || player.team.badgeColor || 'assets/img/team-placeholder.png'" alt="Escudo">
          </div>
          <div class="player-image-container">
            <img [src]="player?.images?.transparent?.['256x256'] || 'assets/img/player-placeholder.png'" alt="{{ player.nickname }}">
            <span class="player-position-badge">DEF</span>
          </div>
          <div class="player-info-container">
            <div class="player-name">{{ player.nickname }}</div>
            <div class="player-points">{{ player.matchdayPoints || 0 }} pts</div>
          </div>
        </div>
      </div>

      <!-- Centrocampistas -->
      <div class="position-row midfielders">
        <div class="player-card" *ngFor="let player of midfielders">
          <div class="team-badge" *ngIf="player.team">
            <img [src]="player.team.badge || player.team.badgeColor || 'assets/img/team-placeholder.png'" alt="Escudo">
          </div>
          <div class="player-image-container">
            <img [src]="player?.images?.transparent?.['256x256'] || 'assets/img/player-placeholder.png'" alt="{{ player.nickname }}">
            <span class="player-position-badge">MID</span>
          </div>
          <div class="player-info-container">
            <div class="player-name">{{ player.nickname }}</div>
            <div class="player-points">{{ player.matchdayPoints || 0 }} pts</div>
          </div>
        </div>
      </div>

      <!-- Delanteros -->
      <div class="position-row forwards">
        <div class="player-card" *ngFor="let player of forwards">
          <div class="team-badge" *ngIf="player.team">
            <img [src]="player.team.badge || player.team.badgeColor || 'assets/img/team-placeholder.png'" alt="Escudo">
          </div>
          <div class="player-image-container">
            <img [src]="player?.images?.transparent?.['256x256'] || 'assets/img/player-placeholder.png'" alt="{{ player.nickname }}">
            <span class="player-position-badge">DEL</span>
          </div>
          <div class="player-info-container">
            <div class="player-name">{{ player.nickname }}</div>
            <div class="player-points">{{ player.matchdayPoints || 0 }} pts</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estadísticas del equipo -->
  <div class="team-stats" *ngIf="!loading">
    <div class="stat-item">
      <span class="stat-label">Puntos Totales</span>
      <span class="stat-value">{{ totalPoints }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Jornada Actual</span>
      <span class="stat-value">{{ matchday }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Puntos en Jornada</span>
      <span class="stat-value">{{ getMatchdayPoints(matchday) }}</span>
    </div>
  </div>

  <!-- Historial de puntos por jornada -->
  <div class="points-history" *ngIf="!loading && pointsHistory.length > 0">
    <h3>Historial de Puntos</h3>
    <table class="history-table">
      <thead>
        <tr>
          <th>Jornada</th>
          <th>Fecha</th>
          <th>Puntos</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let history of pointsHistory">
          <td>{{ history.matchday }}</td>
          <td>{{ history.date | date:'dd/MM/yyyy' }}</td>
          <td>{{ history.total_points }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="loading" class="loading-container">
    <p>Cargando puntos...</p>
  </div>

  <!-- Modificado para mostrar el mensaje solo cuando no hay jugadores ni puntos -->
  <div *ngIf="!loading && playerPoints.length === 0 && goalkeepers.length === 0 && defenders.length === 0 && midfielders.length === 0 && forwards.length === 0" class="no-data">
    <p>Aún no hay datos de puntos disponibles. Los puntos se actualizarán después de cada jornada.</p>
  </div>

  <!-- Mensaje informativo cuando hay jugadores pero no hay puntos -->
  <div *ngIf="!loading && playerPoints.length === 0 && (goalkeepers.length > 0 || defenders.length > 0 || midfielders.length > 0 || forwards.length > 0)" class="info-message">
    <p>Mostrando alineación actual. Los puntos se actualizarán después de cada jornada.</p>
  </div>
</div>
